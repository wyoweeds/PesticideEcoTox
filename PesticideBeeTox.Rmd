---
title: "Toxicity of pesticides to honey bee used in United States corn and soybean production, 1998 -- 2020"
author: "Andrew R. Kniss"
date: "updated `r Sys.Date()`"
output: html_document
---

---

```{r setup, include = FALSE, warning = FALSE, message = FALSE, results = 'hide'}
library("tidyverse")
library("cowplot")
library("readxl")
library("openxlsx")
library("plotly")
library("rcartocolor")
library("tidytext")

### Load Kynnetec AgroTrak pesticide data (proprietary):
AgroTrak.Timing.dat <- read_excel(
  "DATA/US AgroTrak Chemical Use Timing.xlsx",
  skip = 5) %>%
  select(Year, Crop,
         Timing0 = `Application Timing`,
         Type = `Pesticide Type`,
         Active.Ingredient = `Active Ingredient`,
         Volume.lbs = `AI volume\r\n(lb)`,
         Base.Area.Treated = `Base Area Treated\r\n(acres)`,
         Total.Area.Treated = `Total Area Treated\r\n(acres)`) %>%
  mutate(ai = str_replace_all(Active.Ingredient, " \\(.\\)", ""),
         Timing = case_when(
           Timing0 %in% c("At Planting", "Before Crop Emergence",
                          "Last Fall", "Prior to Planting") ~ "PRE",
           Timing0 %in% c("Early Post (Herbicides)", "Late Post (Herbicides)",
                          "Postemergence (Non-Herbicides)",
                          "Foliar atTasseling (Fungicides)", 
                          "Foliar before Tasseling (Fungicides)") ~ "POST"),
         Timing = factor(Timing, ordered = "TRUE",
                            levels = c("PRE", "POST"))) %>%
  group_by(Year, Crop, Timing, Type, Active.Ingredient, ai) %>%
  summarize(Volume.lbs = round(sum(Volume.lbs)),
            Base.Area.Treated = round(sum(Base.Area.Treated)),
            Total.Area.Treated = round(sum(Total.Area.Treated))) %>%
    mutate(Type = factor(Type,
                         levels = c("Insecticide", "Herbicide", "Fungicide")))
glimpse(AgroTrak.Timing.dat)

## Get full pesticide list from AgroTrak:
AgroTrak.aiList <- AgroTrak.Timing.dat %>%
  select(ai) %>%
  distinct()

### load Farruggia et al. (2022) tox data:
farruggia.s1.all <- read_excel("DATA/journal.pone.0265962.s001.xlsx",
                          sheet = "Supporting Table S1", 
                          skip = 7, 
                          col_names = c("Pesticide", "PCCODE", 
                                        "Type", "Class", "MOA", 
                                        "AAC.LD50", LETTERS[1:7])) %>%
  select(Pesticide:AAC.LD50) %>%
  mutate(ineq = ifelse(str_detect(AAC.LD50, ">"), ">", NA),
         AAC.LD50 = as.numeric(str_remove(AAC.LD50, ">")),
         ai = str_to_upper(Pesticide)) %>%
  mutate(source = "Farruggia et al. 2022") %>%
  select(ai, ineq, AAC.LD50, source)
glimpse(farruggia.s1.all)

### Load concordance file:
srcTab <- read_csv("DATA/cclistInEcotox.csv")
glimpse(srcTab)

### Load honey bee toxicity values from Ecotox export
ecotox.dat0 <- 
  read_excel("DATA/ECOTOX-Terrestrial-Export_20211207.xlsx",
             sheet = "Terrestrial-Export") %>%
  rename(cas.number = "CAS Number", chemName = "Chemical Name") %>%
  filter(`Species Scientific Name` == "Apis mellifera") %>%
  select(source, cas.number, chemName,
         Species = `Species Scientific Name`, 
         Lifestage = `Organism Lifestage`,
         ExposureType = `Exposure Type`, 
         concType = `Conc 1 Type (Author)`,
         Effect, Endpoint, ineq = `Observed Response Mean Op`,
         ObsRespMean = `Observed Response Mean`,
         ToxUnit = `Observed Response Units`,
         ObservedDuration.d = `Observed Duration (Days)`)
glimpse(ecotox.dat0)

### Join with the concordance list:
ecotox.dat1 <- ecotox.dat0 %>%
  filter(Lifestage == "Adult" &
           Endpoint == "LD50" & 
           ExposureType == "Dermal") %>%
  right_join(srcTab) %>%
  select(-inEcoTox, -inManualAdd, -ModeOfAction)
glimpse(ecotox.dat1) 

## SELECTION LOGIC for exported Ecotox data
## For ais with multiple adult acute dermal LD50 values in Ecotox:
## 1) if there is only one exact estimate use it (exclude > values)
## 2) if there are multiple exact estimates, use the lowest value
## 3) if there are no exact estimates, use the lowest > value (questionable...)
ecotox.select1 <- ecotox.dat1 %>%
  group_by(ai) %>%
  mutate(n.est = sum(is.na(ineq))) %>%
  filter(case_when(
    n.est == 1 ~ is.na(ineq), ## (1)
    n.est > 1 ~ is.na(ineq) & ObsRespMean == min(ObsRespMean), ## (2)
    n.est == 0 ~ ObsRespMean == min(ObsRespMean) ## (3)
  )) %>%
  select(ai, ineq, AAC.LD50 = ObsRespMean, source)
glimpse(ecotox.select1)

ecotox.dat2 <- left_join(ecotox.select1 %>% select(ai, 
                                                   eco.ineq = ineq,
                                                   eco.LD50 = AAC.LD50), 
                         farruggia.s1.all %>% select(ai,
                                                     far.ineq = ineq,
                                                     far.LD50 = AAC.LD50)) %>%
    mutate(same.LD50 = eco.LD50 == far.LD50,
           lower.LD50 = case_when(
           eco.LD50 - far.LD50 < 0 ~ "Ecotox",
           eco.LD50 - far.LD50 > 0 ~ "Farruggia",
           same.LD50 == TRUE ~ "Same")) %>%
    arrange(lower.LD50, eco.ineq)
glimpse(ecotox.dat2)
which.farruggia <- ecotox.dat2 %>%
  filter(lower.LD50 == "Farruggia") %>%
  select(ai)
which.farruggia

## Load manually searched tox values from PRA/ERA documents:
missingSearch.dat <- read_excel("DATA/MissingToxDataSearch.xlsx",
                                sheet = "MissingToxDataSearch",
                                range = cell_cols("A:F")) %>%
  select(ai, ineq, AAC.LD50, source)
glimpse(missingSearch.dat)

finalTox.dat <- bind_rows(
  ecotox.select1 %>% filter(!ai %in% which.farruggia$ai & 
                              !is.na(AAC.LD50)),
  farruggia.s1.all %>% filter(ai %in% which.farruggia$ai),
  missingSearch.dat %>% filter(!is.na(AAC.LD50))
) %>%
  group_by(ai) %>%
  distinct()
glimpse(finalTox.dat)
write_csv(finalTox.dat, "finalToxData.csv")

## USDA planted acres:
plantedAcres.dat <- read_csv("DATA/USDA-PlantedAcres_1990-2023.csv") %>%
  mutate(Crop = str_to_title(Commodity),
         PlantedHectares = Value / 2.47) %>%
  select(Year, Crop, PlantedHectares)
glimpse(plantedAcres.dat)

## Merge with usage data
AgroTrak.ecotox <-
  AgroTrak.Timing.dat %>%
  left_join(finalTox.dat) %>%
  mutate(Year = as.numeric(Year),
         Volume.kg = round(Volume.lbs * 0.454),
         BaseArea.ha = round(Base.Area.Treated / 2.47),
         Rate.kgha = Volume.kg / BaseArea.ha) %>%
  left_join(plantedAcres.dat) %>%
  mutate(TreatedProportion = BaseArea.ha / PlantedHectares,
         AreaAdjRate.kgha = Rate.kgha * TreatedProportion,
         ToxIndex.vol = Volume.kg / AAC.LD50,
         ToxIndex.rate = Rate.kgha / AAC.LD50,
         ToxIndex.area = AreaAdjRate.kgha / AAC.LD50)
glimpse(AgroTrak.ecotox)
```

# Data sources:

## Pesticide usage data

Proprietary pesticide usage data were obtained from [Kynetec](https://www.kynetec.com/). Data included the volume, treated acreage, and timing of pesticide applications for corn and soybean from 1998 through 2020. 

## Honey bee toxicity data

Adult acute contact $LD_{50}$ values for honey bee (*Apis mellifera*) were obtained from the following sources:

* The U.S. EPA [ECOTOX](https://cfpub.epa.gov/ecotox/) database.
* Supporting Table S1 from [Farruggia et al (2022)](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0265962)
* Manually searching pesticide registration documents.

First, the ECOTOX database was exported and used as the preferred source for all pesticide toxicity data. For each active ingredient (ai) in the Kynetec data, adult acute contact $LD_{50}$ were downloaded. For ai with multiple values reported, we used the following selection criteria to select a single toxicity value:

1) if there was only one *exact* estimate (as opposed to an inequality) the exact estimate was selected.
2) if there were multiple exact estimates, the lowest (most toxic) value was selected.
3) if there were no exact estimates, the lowest (most toxic) inequality was selected. 

After this selection criteria was applied to the ECOTOX data, the selected toxicity values were compared with those published by Farruggia et al. (2022). In nearly all cases, the ECOTOX values were the same. For 6 pesticides, the values reported by Farruggia et al. were lower (*i.e.* more toxic) than those selected from ECOTOX; for those six pesticides, the Farruggia et al. values were used to ensure we used the most conservative toxicity estimates available. Finally, for any ai in the Kynetec data that did not have toxicity values in ECOTOX or Farruggia et al. (2022), pesticide registration documents were searched manually to obtain honey bee adult acute contact toxicity values. 

```{r, include = FALSE, warning = FALSE, message = FALSE}
missDat <- AgroTrak.ecotox %>%
  group_by(ai) %>%
  summarize(totalVol = signif(sum(Volume.kg), 3),
            totalBase = signif(sum(Base.Area.Treated), 3),
            AAC.LD50 = unique(AAC.LD50)) %>%
  filter(is.na(AAC.LD50) & totalVol > 1000) %>%
  arrange(desc(totalBase)) %>%
  select(ai, AAC.LD50, totalVol, totalBase) %>%
  data.frame()
goodDat <- AgroTrak.ecotox %>%
  group_by(ai) %>%
  summarize(AAC.LD50 = unique(AAC.LD50)) %>%
  filter(!is.na(AAC.LD50)) %>%
  select(ai)
```

In total, there were `r length(missDat$ai) + length(goodDat$ai)` unique pesticides in the Kynetec database applied to either corn or soybean during 1998 to 2020. Of those, we were unable to find a reliable toxicity estimate for `r length(missDat$ai)` pesticides (Table 1).

```{r, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(missDat %>% select(-AAC.LD50),
             col.names = c("Active ingredient", 
                           "Total volume (kg)", 
                           "Total base acres treated"),
             caption = "**Table 1. Active ingredients for which more than 1,000 kg were applied during the period 1998 -- 2020 but do not have a reliable honey bee adult acute contact $LD_{50}$.**")
```

# Honey bee Toxicity Indices

```{r, include = FALSE}
ToxIndex.summary.yr <- AgroTrak.ecotox %>%
  group_by(Year, Crop, Timing, Type) %>%
  summarize(ToxIndex.vol = sum(ToxIndex.vol, na.rm = TRUE),
            ToxIndex.rate = sum(ToxIndex.rate, na.rm = TRUE),
            ToxIndex.area = sum(ToxIndex.area, na.rm = TRUE))
ToxIndex.summary <- AgroTrak.ecotox %>%
  group_by(Crop, Timing, Type) %>%
  summarize(ToxIndex.vol = sum(ToxIndex.vol, na.rm = TRUE),
            ToxIndex.rate = sum(ToxIndex.rate, na.rm = TRUE),
            ToxIndex.area = sum(ToxIndex.area, na.rm = TRUE)) %>%
  group_by(Crop) %>% 
  mutate(cropToxIndex.vol = sum(ToxIndex.vol),
         cropToxIndex.rate = sum(ToxIndex.rate),
         cropToxIndex.area = sum(ToxIndex.area),
         cropToxIndex.volPct = signif(ToxIndex.vol / 
                                         cropToxIndex.vol*100, 2),
         cropToxIndex.ratePct = signif(ToxIndex.rate / 
                                         cropToxIndex.rate*100, 2),
         cropToxIndex.areaPct = signif(ToxIndex.area / 
                                         cropToxIndex.area*100, 2))

ToxIndex.cropTotals <- ToxIndex.summary %>% 
  group_by(Crop) %>% 
  summarize(cropToxIndex.vol = unique(cropToxIndex.vol),
            cropToxIndex.rate = unique(cropToxIndex.rate),
            cropToxIndex.area = unique(cropToxIndex.area))
ToxIndex.cropTotals

cropType.summary <- ToxIndex.summary %>% 
  group_by(Crop, Type) %>%
  summarize(cropToxIndex.volPct = sum(cropToxIndex.volPct),
            cropToxIndex.ratePct = sum(cropToxIndex.ratePct),
            cropToxIndex.areaPct = sum(cropToxIndex.areaPct))
cropType.summary
```

Pesticide use data were separated into pesticides applied before crop emergence (PRE) and pesticides applied after crop emergence (POST). For each ai applied to each crop in each year, three Toxicity Index values were calculated. A volume-based toxicity index ($TI_{vol}$) was calculated by taking the the total pesticide appliied rate $P_{vol}$ in kg and dividing by the acute contact $LD_{50}$ for adult honey bees expressed in $\mu$g / bee.

$$TI_{vol} = (\frac{P_{vol}}{LD_{50}})$$

An application rate-based toxicity index $TI_{rate}$ was calculated by dividing $P_{vol}$ by the area treated with the pesticide in hectares ($A_{trt}$) to get the average application rate, then difiding that application rate by the $LD_{50}$.  

$$TI_{rate} = (\frac{P_{vol} / A_{trt}}{LD_{50}})$$

Finally, an area-adjusted toxicity index ($TI_{area}$) was calculated by multiplying $P_{rate}$ by the proportion of planted area ($A_{planted}$) onto which the pesticide was applied ($A_{trt}$), then dividing by $LD_{50}$:

$$TI_{area} = (\frac{P_{rate} * (A_{trt} / A_{planted})}{LD_{50}})$$
(( This is the same thing as $P_{vol}$ / $A_{planted}$ so need to simplify...))

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 1. Summed honey bee RQ applied to corn or soybean during the period 1998 through 2020 by pesticide type and application timing.**"}
tisum.vol.gg <- ggplot(ToxIndex.summary, 
       aes(x = ToxIndex.vol, y = Type)) +
  facet_grid(Crop ~ Timing) + 
  geom_bar(stat = "identity",
           aes(fill = Crop)) +
  ylab(element_blank()) +
  xlab("Honeybee acute toxicity index") +
  theme_minimal_grid() +
  theme(legend.position = "none")
tisum.rate.gg <- ggplot(ToxIndex.summary, 
       aes(x = ToxIndex.rate, y = Type)) +
  facet_grid(Crop ~ Timing) + 
  geom_bar(stat = "identity",
           aes(fill = Crop)) +
  ylab(element_blank()) +
  xlab("Honeybee acute toxicity index") +
  theme_minimal_grid() +
  theme(legend.position = "none")
tisum.area.gg <- ggplot(ToxIndex.summary, 
       aes(x = ToxIndex.area, y = Type)) +
  facet_grid(Crop ~ Timing) + 
  geom_bar(stat = "identity",
           aes(fill = Crop)) +
  ylab(element_blank()) +
  xlab("Honeybee acute toxicity index") +
  theme_minimal_grid() +
  theme(legend.position = "none")

plot_grid(tisum.rate.gg, tisum.area.gg,
          ncol = 1,
          labels = c("Rate applied", "Area adjusted"),
          hjust = -0.1)
```

* The summed honey bee $TI_{rate}$ over all years was `r round(ToxIndex.cropTotals$cropToxIndex.rate[1]/ToxIndex.cropTotals$cropToxIndex.rate[2], 1)`-times greater in corn compared to soybean.
* The summed honey be $TI_{area}$ over all years was `r round(ToxIndex.cropTotals$cropToxIndex.area[1]/ToxIndex.cropTotals$cropToxIndex.area[2], 1)`-times greater in corn compared to soybean.
  * I think the area-adjusted version is the one worth looking at - just the rate applied seems misleading if somthing was applied at a high rate on very few acres.
* `r cornTot <- ToxIndex.summary %>% filter(Crop == "Corn" & Timing == "PRE") %>% summarize(a = sum(cropToxIndex.areaPct))
round(cornTot[[2]])`% of the summed $TI_{area}$ applied to corn was applied *before* crop emergence, when relative risk to honey bees and many other pollinator species is expected to be lower. 
* `r soyTot <- ToxIndex.summary %>% filter(Crop == "Soybeans" & Timing == "POST") %>% summarize(a = sum(cropToxIndex.areaPct))
round(soyTot[[2]])`% of the summed $TI_{area}$ applied to soybean was applied *after* crop emergence, when relative risk to honey bees and many other pollinator species is expected to be higher.
* In corn, insecticides were responsible for `r corn.i <- cropType.summary %>% filter(Crop == "Corn" & Type == "Insecticide")
corn.i$cropToxIndex.areaPct`% of $TI_{area}$, compared to `r corn.h <- cropType.summary %>% filter(Crop == "Corn" & Type == "Herbicide")
signif(corn.h$cropToxIndex.areaPct,2)`% for herbicides, and `r corn.f <- cropType.summary %>% filter(Crop == "Corn" & Type == "Fungicide")
signif(corn.f$cropToxIndex.areaPct,2)`% for fungicides.
* In soybean, insecticides were responsible for `r soy.i <- cropType.summary %>% filter(Crop == "Soybeans" & Type == "Insecticide")
signif(soy.i$cropToxIndex.areaPct,2)`% of the summed $TI{area}$, compared to `r soy.h <- cropType.summary %>% filter(Crop == "Soybeans" & Type == "Herbicide")
signif(soy.h$cropToxIndex.areaPct,2)`% for herbicides, and `r soy.f <- cropType.summary %>% filter(Crop == "Soybeans" & Type == "Fungicide")
signif(soy.f$cropToxIndex.areaPct,2)`% for fungicides.

---

```{r, include = FALSE, warning = FALSE, message = FALSE}
options(scipen = 10)
knitr::kable(ToxIndex.summary %>% 
               pivot_wider(id_cols = c(Type, Timing),
                           names_from = Crop,
                           values_from = cropToxIndex.areaPct) %>%
               arrange(Timing, Type),
             caption = "**Table 2. Percentage of the total honey bee risk quotient in corn and soybean by pesticide type and application timing.**")
```




```{r, echo = FALSE, warning = FALSE, message = FALSE}
ToxIndex.plot <- function(
    data = ToxIndex.summary.yr, 
    crop, timing, 
    excludeType = "none") {
  data %>% filter(Crop == crop & Timing == timing & Type != excludeType) %>%
    ggplot(aes(y = ToxIndex.area, x = Year)) +
    facet_wrap(~ Type, scales = "free_y",
               ncol = 1) +
    geom_point() + 
    stat_smooth(se = FALSE, span = 0.9) +
    ylab("Honeybee acute toxicity index") +
    #theme_minimal_hgrid() +
    theme_gray(base_size = 18) +
    scale_y_continuous(limits = c(0, NA), expand = c(0, 0)) +
    ggtitle(paste(crop, timing))
}
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 2. Honey bee adult acute contact risk quotient for pesticides applied to corn or soybean *before* crop emergence.**"}
plot_grid(ToxIndex.plot(crop = "Corn", 
                        timing = "PRE", 
                        excludeType = "Fungicide"),
          ToxIndex.plot(crop = "Soybeans", 
                        timing = "PRE", 
                        excludeType = "Fungicide"),
          nrow = 1)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 9, fig.height = 8, fig.cap = "**Figure 3. Honey bee adult acute contact risk quotient for pesticides applied to corn or soybean *after* crop emergence.**"}
plot_grid(ToxIndex.plot(crop = "Corn", timing = "POST"),
          ToxIndex.plot(crop = "Soybeans", timing = "POST"),
          nrow = 1)
```


## Active ingredient contributions (2016-2020)

```{r, include = FALSE}
ToxIndex.post2015 <- AgroTrak.ecotox %>%
  filter(Year > 2015) %>%
  group_by(Crop, Timing, Type, ai) %>%
  summarize(ToxIndex.area = sum(ToxIndex.area, na.rm = TRUE)) %>%
  ungroup()
```


```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 4. Contribution of individual pesticides to the honey bee adult acute contact risk quotient; corn pesticides applied *after* crop emergence, 2016-2020.**"}
ToxIndex.post2015 %>%
  filter(Crop == "Corn" & Timing == "POST") %>%
  arrange(-ToxIndex.area) %>% 
  top_n(25) %>%
  ggplot(aes(x = ToxIndex.area, y = reorder(ai, ToxIndex.area))) +
  geom_point(aes(color = Type, shape = Type)) +
  xlab("Honey bee acute toxicity index") +
  ylab(element_blank()) +
  ggtitle("Corn POST - 2016-2020") +
  theme_gray(base_size = 18)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 5. Contribution of individual pesticides to the honey bee adult acute contact risk quotient; soybean pesticides applied *after* crop emergence, 2016-2020.**"}
ToxIndex.post2015 %>%
  filter(Crop == "Soybeans", Timing == "POST") %>%
  arrange(-ToxIndex.area) %>% 
  top_n(25) %>%
  ggplot(aes(x = ToxIndex.area, y = reorder(ai, ToxIndex.area))) +
  geom_point(aes(color = Type, shape = Type)) +
  xlab("Honey bee acute toxicity index") +
  ylab(element_blank()) +
  ggtitle("Soybean POST - 2016-2020") +
  theme_gray(base_size = 18)
```

```{r, include = FALSE}
### I don't remember what I was going to do with this?
```

# Pest Index

```{r, include = FALSE}
## Currently only includes insects
pestList <- read_excel("DATA/PestLists.xlsx",
                       sheet = "PestList") %>%
  select(Crop, Pest, TaxonGroup)

AgroTrak.PestTiming.dat <- read_excel(
  "DATA/US AgroTrak Chemical Use Timing and Pests.xlsx",
  skip = 5) %>%
  select(Year, Crop,
         Timing0 = `Application Timing`,
         Type = `Pesticide Type`,
         Active.Ingredient = `Active Ingredient`,
         Pest = Pests,
         Volume.lbs = `AI volume\r\n(lb)`,
         Base.Area.Treated = `Base Area Treated\r\n(acres)`,
         Total.Area.Treated = `Total Area Treated\r\n(acres)`) %>%
  mutate(Year = as.numeric(Year),
         ai = str_replace_all(Active.Ingredient, " \\(.\\)", ""),
         Timing = case_when(
           Timing0 %in% c("At Planting", "Before Crop Emergence",
                          "Last Fall", "Prior to Planting") ~ "PRE",
           Timing0 %in% c("Early Post (Herbicides)", "Late Post (Herbicides)",
                          "Postemergence (Non-Herbicides)",
                          "Foliar atTasseling (Fungicides)", 
                          "Foliar before Tasseling (Fungicides)") ~ "POST"),
         Volume.kg = Volume.lbs * 454,
         Treated.ha = Base.Area.Treated / 2.47,
         AppRate.kgha = Volume.kg / Treated.ha) %>%
  left_join(pestList)
glimpse(AgroTrak.PestTiming.dat)

groupToxIndex <- AgroTrak.ecotox %>%
  group_by(Year, Crop, Timing) %>%
  mutate(ToxIndex.groupSum = sum(ToxIndex.area, na.rm = TRUE),
         ToxIndex.groupProp = ToxIndex.area / ToxIndex.groupSum) %>%
  select(Year, Crop, Timing, ai, 
         ToxIndex.groupProp)
glimpse(groupToxIndex)

AgroTrak.PestToxIndex <- AgroTrak.PestTiming.dat %>%
  left_join(groupToxIndex) %>% 
  select(-Timing0) %>%
  group_by(Year, Crop, Timing, ai) %>%
  mutate(ai.pestVol = Volume.kg / sum(Volume.kg)) %>%
  select(Year, Crop, Type, ai, Timing, Pest, TaxonGroup, 
         ToxIndex.groupProp, ai.pestVol) %>%
  ungroup() %>%
  mutate(pestToxIndex = ToxIndex.groupProp * ai.pestVol)
glimpse(AgroTrak.PestToxIndex)
```

A pesticide target toxicity index was calculated using the following formula
For each active ingredient (applied in each year, crop, and timing), the volume applied targeting a particular pest was divided by the total volume of the active ingredient applied. This proportion was then multiplied by the proportion that active ingredient contributed to the area toxicity index $TI_{area}$.

$$TI_{pest} = (P_{pest} / P_{total}) * (TI_{area.ai} / TI_{area.group})$$
[this equation needs to be converted to sigma notation to be accurate....]

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 6. Contribution of insect pests to the honey bee adult acute contact toxicity index; corn pesticides applied *after* crop emergence, 1998-2020.**"}
AgroTrak.PestToxIndex %>%
  filter(Type == "Insecticide" & 
           Timing == "POST" &
           Crop == "Corn" &
           TaxonGroup != "Unknown" & !is.na(TaxonGroup)) %>%
  group_by(Crop, Year, TaxonGroup) %>%
  summarize(pestToxIndex.sum = sum(pestToxIndex, na.rm = TRUE)) %>%
  group_by(Crop, TaxonGroup) %>%
  mutate(taxonKeep = length(!is.na(pestToxIndex.sum)) > 4) %>%
  filter(taxonKeep == TRUE) %>%
  ggplot(aes(x = Year, y = pestToxIndex.sum)) +
  geom_point() + stat_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ TaxonGroup) +
  ggtitle("Corn POST Insecticide Targets") +
  ylab("Total Pest Toxicity Index")
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 7. Contribution of insect pests to the honey bee adult acute contact toxicity index; soybean pesticides applied *after* crop emergence, 1998-2020.**"}
AgroTrak.PestToxIndex %>%
  filter(Type == "Insecticide" & 
           Timing == "POST" &
           Crop == "Soybeans" &
           TaxonGroup != "Unknown" & !is.na(TaxonGroup)) %>%
  group_by(Crop, Year, TaxonGroup) %>%
  summarize(pestToxIndex.sum = sum(pestToxIndex, na.rm = TRUE)) %>%
  group_by(Crop, TaxonGroup) %>%
  mutate(taxonKeep = length(!is.na(pestToxIndex.sum)) > 4) %>%
  filter(taxonKeep == TRUE) %>%
  ggplot(aes(x = Year, y = pestToxIndex.sum)) +
  geom_point() + stat_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ TaxonGroup) +
  ggtitle("Soybean POST Insecticide Targets") +
  ylab("Total Pest Toxicity Index")

```

```{r include = FALSE}
weedToxIndex.post <- AgroTrak.PestToxIndex %>%
  filter(Type == "Herbicide" & 
           Timing == "POST") %>%
  group_by(Crop, Pest) %>%
  summarize(pestToxIndex.sum = sum(pestToxIndex, na.rm = TRUE)) 
glimpse(weedToxIndex.post)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 8. Contribution of weeds to the honey bee adult acute contact toxicity index; corn herbicides applied *after* crop emergence, 1998-2020.**"}
weedToxIndex.post %>%
  filter(Crop == "Corn") %>%
  slice_max(pestToxIndex.sum, n = 30) %>%
  ggplot(aes(x = pestToxIndex.sum,
             y = reorder(Pest, pestToxIndex.sum))) +
  geom_bar(stat = "identity") +
  ggtitle("Corn POST - Herbicide targets") +
  ylab(element_blank()) +
  xlab("Summed Pest Toxicity Index")
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 6, fig.cap = "**Figure 9. Contribution of weeds to the honey bee adult acute contact toxicity index; soybean herbicides applied *after* crop emergence, 1998-2020.**"}
weedToxIndex.post %>%
  filter(Crop == "Soybeans") %>%
  slice_max(pestToxIndex.sum, n = 30) %>%
  ggplot(aes(x = pestToxIndex.sum,
             y = reorder(Pest, pestToxIndex.sum))) +
  geom_bar(stat = "identity") +
  ggtitle("Soybean POST - Herbicide targets") +
  ylab(element_blank()) +
  xlab("Summed Pest Toxicity Index")

```